<!doctype html>
<html lang="en">
<head>
  <title>three.js- pointerlock controls tut</title>
  <style>
    html,body {
      width: 100%;
      height: 100%;
    }
    body {
      background-color: #ffffff;
      margin: 0;
      overflow: hidden;
      font-family: arial;
    }
    #blocker {
      position:absolute;
      width: 100%;
      height: 100%;
      background-color: rbga(0,0,0,0.5);
    }
    #instructions {
      width:100%;
      height:100%;
      display: -webkit-box;
      display: -moz-box;
      display: box;

      -webkit-box-orient: horizontal;
      -moz-box-orient: horizontal;
      box-orient: horizontal;

      -webkit-box-pack: center;
      -moz-box-pack: center;
      box-pack: center;OrbitControls

      -webkit-box-align: center;
      -moz-box-align: center;
      box-align: center;

      color: #ffffff;
      text-align: center;

      cursor: pointer;
    }
    </style>
  <meta charset="utf-8">
</head>
<body style="margin: 0;">
 
  <script src="js/three.min.js"></script>
  <script src="js/OrbitControls.js"></script>
  <script src="js/EditorControls.js"></script>
  <script src="js/FirstPersonControls.js"></script>
  <script src="js/PointerLockControls.js"></script>

  <div id = "blocker">
    <div id = "instructions">
      <span style = "font-size:40px">Click to play</span>
      <br />
      (W, A, S, D = Move, SPACE = Jump, MOUSE = Look around)
    </div>
  </div>
  <script>
 
    // Our 3D code will go here...
 	  var scene,camera,renderer;
    var controls,time = Date.now();
 	  var blocker = document.getElementById( 'blocker' );
    var instructions = document.getElementById( 'instructions' );

    var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;

    //pointerlock setup
    if ( havePointerLock ) {
      var element = document.body;

      var pointerlockchange = function ( event ) {
        if ( document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element ) {
          controls.enabled = true;

          blocker.style.display = 'none';

        } else {
          controls.enabled = false;

          blocker.style.display = '-webkit-box';
          blocker.style.display = '-moz-box';
          blocker.style.display = 'box';

          instructions.style.display = '';

        }
      }
      var pointerlockerror = function( event ) {
        instructions.style.display = '';
      }

      // pointer lock state change events
      document.addEventListener( 'pointerlockchange', pointerlockchange, false );
      document.addEventListener( 'mozpointerlockchange', pointerlockchange, false );
      document.addEventListener( 'webkitpointerlockchange', pointerlockchange, false );
      document.addEventListener( 'pointerlockerror', pointerlockerror, false );
      // mozpointer
      // webkitpointer

      instructions.addEventListener( 'click', function ( event ) {

        instructions.style.display = 'none';

        //Ask browser to lock pointer
        element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;
        if ( /Firefox/i.test( navigator.userAgent ) ) {
          var fullscreenchange = function ( event ) {
            if ( document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element) {
              document.removeEventListener( 'fullscreenchange', fullscreenchange );
              document.removeEventListener( 'mozfullscreenchange', fullscreenchange );
              element.requestPointerLock();
            }
          }

          document.addEventListener( 'fullscreenchange', fullscreenchange, false );
          document.addEventListener( 'mozfullscreenchange', fullscreenchange, false );
          element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;
          element.requestFullscreen();
        } else {
        element.requestPointerLock();
      }
      }, false );
    } else {
      instructions.innerHTML = 'Your browser doesn\'t seem to support Pointer Lock API'; 
    }
 	  init();
  	animate();
 	  //load_cube();
 	  function init() {
   		//create scene
   		scene = new THREE.Scene();
   		var WIDTH = window.innerWidth;
   		var HEIGHT = window.innerHeight;
   		// alert("past scene");

   		//create renderer
   		renderer = new THREE.WebGLRenderer({antialias:true});
      renderer.setClearColor(0xEEEEEE,1.0);
      renderer.clear();
   		renderer.setSize(WIDTH,HEIGHT);
   		document.body.appendChild(renderer.domElement);
   		// alert("past renderer");

   		//create camera
   		camera = new THREE.PerspectiveCamera(45, WIDTH/HEIGHT, 0.1, 20000);
   		camera.position.set(0,0,300);
   		scene.add(camera);
   		// alert("past camera");

   		//update on resize
   		window.addEventListener('resize',function() {
   			var WIDTH = window.innerWidth,
   				HEIGHT = window.innerHeight;
   			renderer.setSize(WIDTH, HEIGHT);
   			camera.aspect = WIDTH / HEIGHT;
   			camera.updateProjectionMatrix();
   		});
   		// alert("past updateresize");

   		//lighting
   		var light = new THREE.PointLight(0xffffff);
   		light.position.set(-100,200,100);
   		scene.add(light);
   		// alert("past lighting");

   		//Geometry
   		//load_cube();
      var geometry = new THREE.CubeGeometry(50,50,50);
      var material = new THREE.MeshBasicMaterial( { color: 0x000000 } );
      var cube = new THREE.Mesh( geometry, material );
      scene.add( cube );

      //Controls
      controls = new THREE.PointerLockControls(camera,renderer.domElement);
      scene.add(controls.getObject());

      //floor
      var planeGeo = new THREE.PlaneGeometry(1000, 1000, 10, 10);
      var planeMat = new THREE.MeshLambertMaterial({color: 0xFFFFFF});
      var plane = new THREE.Mesh(planeGeo, planeMat);
      plane.rotation.x = -Math.PI/2;
      plane.position.y = -25;
      plane.receiveShadow = true;
      scene.add(plane);


 	}
 // 	function load_cube() {
 // 		var geometry = new THREE.CubeGeometry(1,1,1);
	// 	var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
	// 	var cube = new THREE.Mesh( geometry, material );
	// 	scene.add( cube );
	// }

  function animate() {
    requestAnimationFrame(animate);
    controls.isOnObject( false );

    // ray.ray.origin.copy( controls.getObject().position );
    // ray.ray.origin.y -= 10;

    // if ( intersections.length > 0 ) {
    //   var distance = intersections[ 0 ].distance;
    //   if ( distance > 0 && distance < 10 ) {
    //     controls.isOnObject( true );
    //   }
    // }
    //Render Scene
    renderer.render(scene,camera);
    controls.update( Date.now() - time );
    renderer.render( scene, camera );
    time = Date.now();
  }

  </script>
 
</body>
</html>